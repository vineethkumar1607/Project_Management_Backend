// ================================
// Prisma Client Generator
// ================================
generator client {
    provider        = "prisma-client-js" // Generates Prisma Client for JS/TS
}

// ================================
// Database Configuration
// ================================
datasource db {
  provider  = "postgresql"                // PostgreSQL database
  url       = env("DATABASE_URL")         // Runtime DB connection (pooled)
  directUrl = env("DIRECT_URL")          // Direct connection for migrations
}



// ================================
// Enums (Domain Constraints)
// ================================

// Role of a user ( inside the workspace )
enum WorkspaceRole {
    ADMIN
    MEMBER
}

// Status of a task in its lifecycle
enum TaskStatus {
    TODO
    IN_PROGRESS
    DONE
}

// Type/classification of a task
enum TaskType {
    TASK
    BUG
    FEATURE
    IMPROVEMENT
    OTHER
}

// Overall status of the project
enum ProjectStatus {
    ACTIVE
    PLANNING
    COMPLETED
    ON_HOLD
    CANCELLED
}

// Priority used across projects and tasks
enum Priority {
    LOW
    MEDIUM
    HIGH
}

// ================================
// User Model
// ================================
model User {
    id        String   @id     // Primary key - Clerk user ID
    name      String                            // User display name
    email     String   @unique                   // Unique email
    image     String   @default("")             // Profile image URL
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

  // Relations
    workspaces      WorkspaceMember[]                               // Workspace memberships
    projects        Project[]         @relation("ProjectOwner")     // Projects owned
    tasks           Task[]            @relation("TaskAssignee")     // Assigned tasks
    comments        Comment[]                                       // Comments written
    ownedWorkspaces Workspace[]                                     // Workspaces owned
    ProjectMember   ProjectMember[]                                 // Project memberships
}


// ================================
// Workspace Model
// ================================
model Workspace {
    id          String   @id @default(uuid())
    name        String
    slug        String   @unique                // URL-friendly identifier
    description String?
    settings    Json     @default("{}")         // Custom workspace settings
    ownerId     String
    createdAt   DateTime @default(now())
    imageUrl   String   @default("")
    updatedAt   DateTime @updatedAt

  // Relations
    members  WorkspaceMember[]
    projects Project[]
    owner    User              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}


// ================================
// Workspace Member (Join Table)
// ================================
model WorkspaceMember {
    id          String        @id @default(uuid())
    userId      String
    workspaceId String
    message     String        @default("")              // Invite message
    role        WorkspaceRole @default(MEMBER)
    user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
    workspace   Workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

    @@unique([userId, workspaceId])                   // prevent duplicate membership
}

model Project {
    id          String          @id @default(uuid())
    name        String
    description String?
    priority    Priority        @default(MEDIUM)
    status      ProjectStatus   @default(ACTIVE)
    start_date  DateTime?
    end_date    DateTime?
    team_lead   String                                  // User ID of project owner
    workspaceId String
    progress    Int             @default(0)
    createdAt   DateTime        @default(now())
    updatedAt   DateTime        @updatedAt
    members     ProjectMember[]

// Relations
    owner     User      @relation("ProjectOwner", fields: [team_lead], references: [id], onDelete: Cascade)
    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
    tasks     Task[]
}


// ================================
// Project Member (Join Table)
// ================================
model ProjectMember {
    id        String  @id @default(uuid())
    userId    String
    projectId String
    user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

    @@unique([userId, projectId]) // prevents duplicate membership
}

// ================================
// Task Model
// ================================
model Task {
    id          String     @id @default(uuid())
    projectId   String
    title       String
    description String?
    status      TaskStatus @default(TODO)
    type        TaskType   @default(TASK)
    priority    Priority   @default(MEDIUM)
    assigneeId  String
    due_date    DateTime
    createdAt   DateTime   @default(now())
    updatedAt   DateTime   @updatedAt

    project  Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
    assignee User      @relation("TaskAssignee", fields: [assigneeId], references: [id], onDelete: Cascade)
    comments Comment[]
}

// ================================
// Comments Model
// ================================
model Comment {
    id        String   @id @default(uuid())
    content   String
    userId    String
    taskId    String
    createdAt DateTime @default(now())

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
    task Task @relation(fields: [taskId], references: [id], onDelete: Cascade)
}
